-- liquibase formatted sql

-- changeset lnv132:1663773305597-1
CREATE TABLE banker (created_at TIMESTAMP DEFAULT NOW() NOT NULL, updated_at TIMESTAMP DEFAULT NOW() NOT NULL, employee_number VARCHAR(10) NOT NULL, first_name VARCHAR(255) NOT NULL, middle_name VARCHAR(255) DEFAULT '' NOT NULL, last_name VARCHAR(255) NOT NULL, email VARCHAR(255) NOT NULL, card_number VARCHAR(10) NOT NULL, id INT AUTO_INCREMENT NOT NULL, CONSTRAINT PK_BANKER PRIMARY KEY (id), UNIQUE (employee_number), UNIQUE (email), UNIQUE (card_number));

-- changeset lnv132:1663773305597-2
CREATE TABLE bankers_clients (banker INT NOT NULL, client INT NOT NULL, CONSTRAINT PK_BANKERS_CLIENTS PRIMARY KEY (banker, client));

-- changeset lnv132:1663773305597-3
CREATE TABLE client (id INT AUTO_INCREMENT NOT NULL, first_name VARCHAR(255) NOT NULL, last_name VARCHAR(255) NOT NULL, email VARCHAR(255) NOT NULL, card_number VARCHAR(10) NOT NULL, active TINYINT(3) DEFAULT 1 NOT NULL, additional_info CLOB, family_members CLOB, created_at TIMESTAMP DEFAULT NOW() NOT NULL, updated_at TIMESTAMP DEFAULT NOW() NOT NULL, middle_name VARCHAR(255) DEFAULT '' NOT NULL, balance DECIMAL(10) NOT NULL, CONSTRAINT PK_CLIENT PRIMARY KEY (id), UNIQUE (email));

-- changeset lnv132:1663773305597-4
CREATE TABLE transactions (id INT AUTO_INCREMENT NOT NULL, type ENUM('withdraw', 'deposit') NOT NULL, amount DECIMAL(10) NOT NULL, client_id INT, CONSTRAINT PK_TRANSACTIONS PRIMARY KEY (id));

-- changeset lnv132:1663773305597-5
CREATE INDEX FK_ebb352c973d8a85e8779a15ff35 ON transactions(client_id);

-- changeset lnv132:1663773305597-6
CREATE INDEX IDX_2464224e61da8368e1fb394202 ON bankers_clients(banker);

-- changeset lnv132:1663773305597-7
CREATE INDEX IDX_87851fe81663efd8d6e50e9401 ON bankers_clients(client);

-- changeset lnv132:1663773305597-8
CREATE UNIQUE INDEX IDX_bc0c644bf2e06d38466b66ecd6 ON client(card_number);

-- changeset lnv132:1663773305597-9
ALTER TABLE bankers_clients ADD CONSTRAINT FK_2464224e61da8368e1fb3942020 FOREIGN KEY (banker) REFERENCES banker (id) ON UPDATE CASCADE ON DELETE CASCADE;

-- changeset lnv132:1663773305597-10
ALTER TABLE bankers_clients ADD CONSTRAINT FK_87851fe81663efd8d6e50e94012 FOREIGN KEY (client) REFERENCES client (id) ON UPDATE CASCADE ON DELETE CASCADE;

-- changeset lnv132:1663773305597-11
ALTER TABLE transactions ADD CONSTRAINT FK_ebb352c973d8a85e8779a15ff35 FOREIGN KEY (client_id) REFERENCES client (id) ON UPDATE RESTRICT ON DELETE CASCADE;

